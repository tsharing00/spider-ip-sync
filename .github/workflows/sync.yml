name: Auto Sync MyWaf Feed IPs

# 触发条件
on:
  schedule:
    # 每天国际标准时间 00:00 运行一次 (北京时间早上 8:00)
    - cron: '0 0 * * *'
  workflow_dispatch: # 允许你手动点击按钮触发测试

# 权限设置：允许脚本写入仓库
permissions:
  contents: write

jobs:
  update-ips:
    runs-on: ubuntu-latest
    
    steps:
      # 1. 检出代码
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. 设置 Python 环境
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. 安装依赖库 (直接指定 requests 和 beautifulsoup4，避免文件读取问题)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4

      # [调试步骤] 列出当前目录文件，确认 Python 脚本是否存在以及叫什么名字
      - name: Debug - List files
        run: ls -la

      # 4. 运行 Python 脚本
      # 根据报错提示找不到 main.py，推测您的仓库中文件名可能仍为 process_ips.py
      # 请确保这里的 python <文件名> 与您仓库里的实际文件名完全一致
      - name: Run IP parser script
        run: python process_ips.py

      # 5. 提交并推送更改 (如果文件有变化)
      - name: Commit and Push changes
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          
          # 添加生成的 txt 文件
          git add spider_white_ips.txt bad_black_ips.txt
          
          # 检查是否有变化，有则提交，无则跳过
          git diff --quiet && git diff --staged --quiet || (git commit -m "Update Spider IPs $(date +'%Y-%m-%d')" && git push)
